<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>üß† BacBo Deep Analyzer ‚Äî ProCode++ Omega</title>

<!-- Estilo -->
<style>
  :root {
    --bg: #07121f;
    --card: #0b1a2a;
    --accent: #00ffc3;
    --blue: #0a84ff;
    --red: #ff3b30;
    --yellow: #ffd60a;
    --muted: #a0b0b9;
  }
  body {
    margin: 0;
    background: var(--bg);
    color: #e6f9ff;
    font-family: "Inter", Arial, sans-serif;
    padding: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  h1 { color: var(--accent); margin-bottom: 10px; }
  .grid {
    display: grid;
    grid-template-columns: 420px 1fr;
    gap: 15px;
    width: 100%;
    max-width: 1200px;
  }
  .card {
    background: var(--card);
    padding: 14px;
    border-radius: 10px;
    box-shadow: 0 0 20px rgba(0,0,0,.3);
  }
  button {
    background: var(--accent);
    border: none;
    border-radius: 8px;
    padding: 8px 12px;
    font-weight: 700;
    cursor: pointer;
  }
  .muted { color: var(--muted); font-size: 13px; }
  textarea {
    width: 100%;
    height: 80px;
    border-radius: 8px;
    background: #0d1b2b;
    color: #e6f9ff;
    border: 1px solid #093a4b;
    padding: 8px;
  }
  .row { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; }
  .chip {
    border-radius: 8px;
    padding: 6px 10px;
    font-weight: bold;
    color: #fff;
    text-align: center;
    min-width: 34px;
  }
  .blue { background: var(--blue); }
  .red { background: var(--red); }
  .yellow { background: var(--yellow); color: #222; }
  .recommend {
    font-size: 18px;
    background: var(--accent);
    color: #001a12;
    font-weight: 800;
    padding: 8px 12px;
    border-radius: 8px;
  }
  pre {
    background: #0a1828;
    border-radius: 8px;
    padding: 10px;
    overflow: auto;
    font-size: 13px;
  }
</style>

<!-- OCR -->
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.1.1/dist/tesseract.min.js"></script>
</head>
<body>
  <h1>üîé BacBo Deep Analyzer ‚Äî ProCode++ Omega</h1>

  <div class="grid">
    <!-- Painel de entrada -->
    <div class="card">
      <div class="muted">Upload da imagem do gr√°fico (BacBo):</div>
      <input id="fileInput" type="file" accept="image/*"/>
      <button id="runOCR">üì∏ Ler imagem e extrair dados</button>
      <hr>
      <div class="muted">Ou cole manualmente (n√∫mero,cor)</div>
      <textarea id="manualInput" placeholder="ex: 9-azul,10-vermelho,11-amarelo"></textarea>
      <button id="analyzeBtn">üîÅ Analisar Agora</button>
      <hr>
      <div class="row">
        <button id="btnAcerto" style="background:#00c37a;">‚úÖ Acertou</button>
        <button id="btnErro" style="background:#ff4d6d;">‚ùå Errou</button>
        <button id="btnEmpate" style="background:#ffd166;">‚öñÔ∏è Empate</button>
        <button id="btnReset" style="background:#33444a;color:#fff;">‚ôªÔ∏è Reset</button>
      </div>
      <hr>
      <div class="muted">Log:</div>
      <pre id="log"></pre>
    </div>

    <!-- Painel de an√°lise -->
    <div class="card">
      <div class="row" style="justify-content:space-between;">
        <div>
          <div class="muted">Tend√™ncia Atual:</div>
          <div id="trend" style="font-weight:800;margin-top:6px;">‚Äî</div>
        </div>
        <div>
          <div class="muted">Pr√≥xima Recomenda√ß√£o:</div>
          <div id="recommendation" class="recommend">‚Äî</div>
        </div>
      </div>
      <hr>
      <div class="muted">Hist√≥rico recente:</div>
      <div id="history" style="display:flex;flex-wrap:wrap;gap:6px;margin-top:8px;"></div>
      <hr>
      <div class="muted">Explica√ß√£o:</div>
      <pre id="explanation"></pre>
    </div>
  </div>

<script>
const log = msg => {
  const el = document.getElementById('log');
  el.textContent += msg + "\\n";
  el.scrollTop = el.scrollHeight;
};

let historyData = JSON.parse(localStorage.getItem('bacbo_history') || '[]');
let weights = JSON.parse(localStorage.getItem('bacbo_weights') || '{"rep":1,"trend":1,"color":1}');
let stats = JSON.parse(localStorage.getItem('bacbo_stats') || '{"hits":0,"tries":0}');

// ======================= OCR =======================
document.getElementById('runOCR').onclick = async () => {
  const file = document.getElementById('fileInput').files[0];
  if(!file) return alert('Escolha uma imagem!');
  log('Lendo imagem... (OCR)');
  try {
    const { data: { text } } = await Tesseract.recognize(file, 'por');
    const numbers = Array.from(text.matchAll(/\\b([3-9]|1[0-8])\\b/g)).map(m=>parseInt(m[1]));
    log('N√∫meros detectados: ' + numbers.join(', '));
    document.getElementById('manualInput').value = numbers.join('-azul,') + '-azul';
    alert('OCR conclu√≠do. Verifique os n√∫meros extra√≠dos.');
  } catch(e) {
    log('Erro OCR: ' + e.message);
  }
};

// ======================= AN√ÅLISE =======================
function analyze() {
  const input = document.getElementById('manualInput').value.trim();
  if(!input) return alert('Insira dados primeiro.');

  const entries = input.split(/[,\\n]+/).map(s => s.trim());
  for(let e of entries){
    const [numStr, colorRaw] = e.split(/[-:]/);
    const num = parseInt(numStr);
    const color = (colorRaw||'').toLowerCase();
    if(num>=3 && num<=18 && ['azul','vermelho','amarelo'].includes(color))
      historyData.push({num,color});
  }
  if(historyData.length > 200) historyData = historyData.slice(-200);
  localStorage.setItem('bacbo_history', JSON.stringify(historyData));
  renderHistory();
  recommendNext();
}

document.getElementById('analyzeBtn').onclick = analyze;

// ======================= RECOMENDA√á√ÉO =======================
function recommendNext(){
  if(historyData.length < 4){
    document.getElementById('recommendation').textContent = '‚Äî';
    document.getElementById('explanation').textContent = 'Poucos dados para an√°lise.';
    return;
  }

  const last = historyData.slice(-1)[0];
  const nums = historyData.map(x=>x.num);
  const colors = historyData.map(x=>x.color);

  // detectar repeti√ß√£o de n√∫mero
  const repScore = {};
  for(let i=3;i<=18;i++){
    const count = nums.filter(x=>x===i).length;
    repScore[i] = 1/(count+1);
  }

  // detectar tend√™ncia (m√©dia m√≥vel)
  const avg = nums.slice(-10).reduce((a,b)=>a+b,0)/Math.min(nums.length,10);
  let trend = avg>11 ? 'Alta' : avg<9 ? 'Baixa' : 'Neutra';
  document.getElementById('trend').textContent = trend;

  // cor mais frequente
  const colorFreq = {azul:0,vermelho:0,amarelo:0};
  colors.forEach(c=>colorFreq[c]++);
  const colorNext = Object.entries(colorFreq).sort((a,b)=>a[1]-b[1])[0][0]; // menos frequente

  // combina√ß√£o ponderada
  const nextNum = Object.entries(repScore).sort((a,b)=>b[1]-a[1])[0][0];
  const explanation = `
√öltimas rodadas: ${nums.slice(-10).join(', ')}
Tend√™ncia detectada: ${trend}
Cor menos frequente: ${colorNext}
Maior potencial de repeti√ß√£o reversa: ${nextNum}
Pesos atuais: ${JSON.stringify(weights, null, 2)}
  `.trim();

  document.getElementById('recommendation').textContent = `${nextNum} (${colorNext})`;
  document.getElementById('explanation').textContent = explanation;
}

// ======================= RENDER =======================
function renderHistory(){
  const h = document.getElementById('history');
  h.innerHTML = '';
  historyData.slice(-60).forEach(e=>{
    const d = document.createElement('div');
    d.className = 'chip ' + (e.color==='azul'?'blue':e.color==='vermelho'?'red':'yellow');
    d.textContent = e.num;
    h.appendChild(d);
  });
}

// ======================= FEEDBACK =======================
function feedback(type){
  stats.tries++;
  if(type==='acerto') stats.hits++;

  // aprendizado simples
  if(type==='acerto'){ weights.rep*=1.03; weights.color*=1.02; }
  if(type==='erro'){ weights.rep*=0.97; weights.color*=0.95; }
  if(type==='empate'){ weights.trend*=1.01; }

  for(let k in weights)
    weights[k] = Math.max(0.3, Math.min(3, weights[k]));

  localStorage.setItem('bacbo_weights', JSON.stringify(weights));
  localStorage.setItem('bacbo_stats', JSON.stringify(stats));
  recommendNext();
}

document.getElementById('btnAcerto').onclick = ()=>feedback('acerto');
document.getElementById('btnErro').onclick = ()=>feedback('erro');
document.getElementById('btnEmpate').onclick = ()=>feedback('empate');
document.getElementById('btnReset').onclick = ()=>{
  if(confirm('Resetar tudo?')){
    localStorage.clear();
    historyData = [];
    renderHistory();
    document.getElementById('explanation').textContent = '';
    document.getElementById('recommendation').textContent = '‚Äî';
  }
};

// inicializa√ß√£o
renderHistory();
recommendNext();
</script>
</body>
</html>
