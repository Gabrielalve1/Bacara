<<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Baccarat AI Vision Pro</title>
<style>
body { background:#000; color:#fff; font-family:Arial,sans-serif; text-align:center; }
h1 { color:#00ffc3; margin-top:20px; }
button,input { padding:10px 15px; margin:8px; border:none; border-radius:6px; font-size:16px; cursor:pointer; }
button { background:#00ffc3; color:#000; font-weight:bold; }
#output { background:#111; padding:20px; border-radius:10px; width:90%; margin:20px auto; text-align:left; font-size:18px; }
.player { color:#00ffc3; font-weight:bold; }
.banker { color:#ff3366; font-weight:bold; }
.tie { color:#ffff33; font-weight:bold; }
#feedback { margin-top:20px; }
table { margin:10px auto; border-collapse:collapse; width:90%; }
th,td { border:1px solid #fff; padding:8px; text-align:center; }
th { background:#222; }
</style>
</head>
<body>

<h1>üîÆ Baccarat AI Vision Pro</h1>

<p>Envie a imagem do gr√°fico apenas uma vez:</p>
<input type="file" id="fileInput" accept="image/*">
<button onclick="analisar()">üì∏ Analisar Gr√°fico</button>

<div id="output">Aguardando imagem...</div>

<div id="feedback" style="display:none;">
  <p>Informe o resultado da rodada:</p>
  <button onclick="registrar('acerto')">‚úÖ Acertou</button>
  <button onclick="registrar('erro')">‚ùå Erro</button>
  <button onclick="registrar('empate')">‚öñÔ∏è Empate</button>
</div>

<h2>Hist√≥rico de Rodadas</h2>
<table>
  <thead>
    <tr>
      <th>#</th>
      <th>Resultado</th>
      <th>Recomenda√ß√£o</th>
    </tr>
  </thead>
  <tbody id="tabela"></tbody>
</table>

<script>
let rodada = 0;
let ultimaRecomendacao = "";

async function analisar() {
  const file = document.getElementById("fileInput").files[0];
  if(!file){ alert("Selecione uma imagem do gr√°fico!"); return; }

  document.getElementById("output").innerHTML = "üß† Lendo e analisando o gr√°fico...";

  // Criar Canvas para ler imagem
  const img = new Image();
  img.src = URL.createObjectURL(file);
  img.onload = async () => {
    const canvas = document.createElement('canvas');
    canvas.width = img.width;
    canvas.height = img.height;
    const ctx = canvas.getContext('2d');
    ctx.drawImage(img,0,0);

    // Detectar bolinhas: Player=azul, Banker=vermelho, Empate=amarelo
    const data = ctx.getImageData(0,0,canvas.width,canvas.height).data;
    let countPlayer=0,countBanker=0,countTie=0;

    for(let i=0;i<data.length;i+=4){
      const r=data[i],g=data[i+1],b=data[i+2];
      // azul = Player
      if(b>150 && r<100 && g<100) countPlayer++;
      // vermelho = Banker
      else if(r>150 && g<100 && b<100) countBanker++;
      // amarelo = Tie
      else if(r>150 && g>150 && b<100) countTie++;
    }

    // Decidir recomenda√ß√£o
    if(countPlayer>=countBanker && countPlayer>=countTie) ultimaRecomendacao="Player";
    else if(countBanker>=countPlayer && countBanker>=countTie) ultimaRecomendacao="Banker";
    else ultimaRecomendacao="Empate";

    document.getElementById("output").innerHTML = `
      üí° Recomenda√ß√£o: <span class='${ultimaRecomendacao.toLowerCase()}'>${ultimaRecomendacao}</span><br>
      üîç Aguarde o feedback do resultado.
    `;
    document.getElementById("feedback").style.display = "block";
  }
}

async function registrar(resultado){
  rodada++;
  await fetch("/api/feedback", {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ recomendacao: ultimaRecomendacao, resultado })
  });

  const tbody = document.getElementById("tabela");
  const tr = document.createElement("tr");
  tr.innerHTML = `<td>${rodada}</td><td>${resultado}</td><td>${ultimaRecomendacao}</td>`;
  tbody.appendChild(tr);

  document.getElementById("feedback").style.display = "none";
  document.getElementById("output").innerHTML += "<br>üîÅ Pronto para a pr√≥xima rodada.";
}
</script>

</body>
</html>
